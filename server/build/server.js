(()=>{"use strict";var e={6752:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=o(r(6860)),n=o(r(3582)),i=o(r(3986)),s=o(r(3316)),c=r(8654),l=r(2815),u=r(2097),d=(0,a.default)(),p="3000";d.use((0,n.default)()),d.use(i.default.json()),d.use(i.default.urlencoded({extended:!1})),d.use(s.default.logger({winstonInstance:u.appLogger,statusLevels:!0})),d.use(l.appModule),d.use(u.errorLogger),d.use(c.errorHandler),d.listen(p,(()=>{console.log(`Server working at port ${p}`)}))},3973:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.appLogger=void 0;const a=r(6937),n=(o(r(7773)),(0,a.createLogger)({loggerName:"app",loggerLevels:["info","error","warn"]}));t.appLogger=n},2097:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.errorLogger=t.appLogger=void 0;const o=r(4747);Object.defineProperty(t,"errorLogger",{enumerable:!0,get:function(){return o.internalErrorsLogger}});const a=r(3973);Object.defineProperty(t,"appLogger",{enumerable:!0,get:function(){return a.appLogger}})},4747:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.internalErrorsLogger=void 0;const a=o(r(7773)),n=o(r(3316));t.internalErrorsLogger=n.default.errorLogger({transports:[new a.default.transports.File({filename:"logs/app/logsInternalErrors.log"})],format:a.default.format.combine(a.default.format.json(),a.default.format.timestamp(),a.default.format.printf((({level:e,meta:t,timestamp:r})=>`${r} ${e}: ${t.message}`)))})},8654:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandler=void 0;const o=r(4787),a=r(9696);t.errorHandler=(e,t,r,n)=>{const i=o.AppError.getErrorFrom(e),s=new a.ResponseFormatter({error:i}).json();r.status(i.status).send(s)}},4428:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validationMiddleware=void 0;const o=r(4787),a=r(9696),n=r(3553);t.validationMiddleware=function(e){return async(t,r,i)=>{for(let r of e)if(!(await r.run(t)).isEmpty())break;const s=(0,n.validationResult)(t);if(s.isEmpty())return i();const c=o.AppError.getErrorFrom(s.array()[0].msg),l=new a.ResponseFormatter({status:c.status,error:c}).json();r.status(c.status).send(l)}}},6601:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var a,n=arguments.length,i=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.CalculatorController=void 0;const a=r(3553),n=r(7022),i=r(1242),s=r(935),c=r(8604);class l{static getOperations(e,t){const r=i.CalculatorService.getOperations();return c.calculatorLog.info("Getting operations"),{items:r,total:r.length}}static async getHistory(e,t){const r=(0,a.matchedData)(e),o=Number(r.limit)||5;return{items:await n.HistoryService.getLastLastHistoryItems(o),total:await n.HistoryService.getHistoryLength()}}static async calculate(e,t){const{expression:r}=(0,a.matchedData)(e);c.calculatorLog.info(`Calculate expression: ${r}`);const o=i.CalculatorService.calculateExpression(r),s={result:o,expression:r};return c.calculatorLog.info(`Calculation result: ${r} = ${o}`),await n.HistoryService.addHistoryItem(s),s}}o([s.responseHandler],l,"getOperations",null),o([s.responseHandler],l,"getHistory",null),o([s.responseHandler],l,"calculate",null),t.CalculatorController=l},2818:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculatorModule=void 0;const o=r(7382);t.calculatorModule={router:o.calculatorRouter}},4261:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.expressionValidation=void 0;const o=r(3553),a=r(4428),n=r(727),i=r(9915);t.expressionValidation=(0,a.validationMiddleware)([(0,o.body)("expression").notEmpty().withMessage(i.ErrorFactory.MissingParameterError("expression","body")).custom(n.validateExpression)])},5192:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.historyValidation=void 0;const o=r(9915),a=r(3553),n=r(4428),i=o.ErrorFactory.IncorrectParameter('The "limit" parameter must take integer values ​​from 1 to 20');t.historyValidation=(0,n.validationMiddleware)([(0,a.query)("limit").optional().isNumeric().withMessage(i).isInt({min:1,max:20}).withMessage(i)])},7382:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculatorRouter=void 0;const o=r(6860),a=r(4261),n=r(6601),i=r(5192),s=(0,o.Router)();t.calculatorRouter=s,s.post("/calculator/calculate",a.expressionValidation,n.CalculatorController.calculate),s.get("/calculator/operations",n.CalculatorController.getOperations),s.get("/calculator/history",i.historyValidation,n.CalculatorController.getHistory)},1242:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CalculatorService=void 0;const o=r(5039),a=r(3005),n=r(7905),i=r(7155),s=r(7218),c=r(4613),l=r(8870),u=r(5563);t.CalculatorService=class{static calculateExpression(e){const t=(0,u.formatExpression)(e),r=this.processBracketedExpression(t),o=process.env.PRECISION||7;return(0,c.formatDecimal)(Number(r),Number(o))}static processBracketedExpression(e){const t=(0,o.getMostNestedBrackets)(e).reduce(((e,t)=>{const r=(0,n.unwrapBracketInExpression)(t),o=this.calculateUnbracketedExpression(r);return e.replace(t,o)}),e);return(0,a.hasBrackets)(t)?this.processBracketedExpression(t):this.calculateUnbracketedExpression(t)}static calculateUnbracketedExpression(e){return(0,s.getOperationsFromExpression)(e).sort(((e,t)=>l.calculatorConfig[t].priority-l.calculatorConfig[e].priority)).reduce(((t,r)=>{const o=l.calculatorConfig[r],a=t.match(o.reg);if(!a)return e;const[n]=a,s=(0,i.getNumbersFromExpression)(n);o.checkException(s,n);const c=o.calculate(...s).toString();return t.replace(n,c)}),e)}static getOperations(){return l.allowedActions.reduce(((e,t)=>[...e,{operationSymbol:l.calculatorConfig[t].text||t,operation:t}]),[])}}},7022:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryService=void 0;const o=r(2766);t.HistoryService=class{static async getLastLastHistoryItems(e){return await o.calculatorHistoryDAO.countHistoryItems(e)}static async addHistoryItem(e){await o.calculatorHistoryDAO.setItem(e)}static async getHistoryLength(){return(await o.calculatorHistoryDAO.getAll()).length}}},2766:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculatorHistoryDAO=t.CalculatorHistoryDAO=void 0;const o=r(6391),a=r(6342);class n{constructor(e){this.maxSize=20,this.db=e}async getAll(){return this.db.getAll()}async countHistoryItems(e){return this.db.count(e)}async getItem(e){return this.db.getItem({field:"expression",value:e})}async setItem(e){await this.db.setItem(e);const t=await this.db.getLength();console.log(t),t>this.maxSize&&await this.db.pop()}}t.CalculatorHistoryDAO=n,new o.JsonDB("./src/data/history.json");const i=new n(new a.PostgreSQL({tableName:"history",fields:[{name:"expression",type:"TEXT",constraints:["NOT NULL"]},{name:"result",type:"FLOAT",constraints:["NOT NULL"]}]}));t.calculatorHistoryDAO=i},3737:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculatorConfig=void 0;const o=r(9219),a=r(3956),n=r(6790),i=r(9613),s=r(133),c=r(16);t.calculatorConfig={"+":new a.Operation({priority:o.Priority.Low,reg:s.regularWithParam.getNumberBetweenRegWithSymbol("+"),calculate:(e,t)=>e+t}),"-":new a.Operation({priority:o.Priority.Low,reg:s.regularWithParam.getNumberBetweenRegWithSymbol("-"),calculate:(e,t)=>e-t}),"*":new a.Operation({priority:o.Priority.Medium,reg:s.regularWithParam.getNumberBetweenRegWithSymbol("*"),calculate:(e,t)=>e*t,text:"×"}),"/":new a.Operation({priority:o.Priority.Medium,reg:s.regularWithParam.getNumberBetweenRegWithSymbol("/"),calculate:(e,t)=>e/t,exceptionHandler:[i.exceptions.zeroDivision],text:"÷"}),"^":new a.Operation({priority:o.Priority.Hight,reg:s.regularWithParam.getNumberBetweenRegWithSymbol("^"),calculate:(e,t)=>Math.pow(e,t),text:"<span>x<sup>y</sup></span>"}),"%":new a.Operation({priority:o.Priority.Low,reg:s.regularWithParam.getNumberBetweenRegWithSymbol("%"),calculate:(e,t)=>t*(1+e/100)-t}),"!":new a.Operation({priority:o.Priority.Hight,reg:s.regularWithParam.getNumbersLeftToSymbolReg("!"),calculate:c.factorial,exceptionHandler:[i.exceptions.negativeNumber,i.exceptions.notInteger]}),sqrt:new a.Operation({priority:o.Priority.Hight,calculate:Math.sqrt,exceptionHandler:[i.exceptions.negativeNumber],reg:s.regularWithParam.getFunctionRegWithParam("sqrt"),type:n.OperationType.MathFunction,text:"√"}),sin:new a.Operation({priority:o.Priority.Hight,calculate:Math.sin,reg:s.regularWithParam.getFunctionRegWithParam("sin"),type:n.OperationType.MathFunction}),cos:new a.Operation({priority:o.Priority.Hight,calculate:Math.cos,reg:s.regularWithParam.getFunctionRegWithParam("cos"),type:n.OperationType.MathFunction}),tg:new a.Operation({priority:o.Priority.Hight,calculate:Math.sin,reg:s.regularWithParam.getFunctionRegWithParam("tg"),type:n.OperationType.MathFunction}),ctg:new a.Operation({priority:o.Priority.Hight,calculate:e=>1/Math.tan(e),reg:s.regularWithParam.getFunctionRegWithParam("ctg"),type:n.OperationType.MathFunction}),pi:new a.Operation({priority:o.Priority.Constant,calculate:()=>Math.PI,reg:s.regularWithParam.getConstantReg("pi"),type:n.OperationType.Constant}),e:new a.Operation({priority:o.Priority.Constant,calculate:()=>Math.E,reg:s.regularWithParam.getConstantReg("e"),type:n.OperationType.Constant})}},9613:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exceptions=void 0,t.exceptions={zeroDivision:{checkException:(e,t)=>0===t,exceptionMessage:"Zero division"},negativeNumber:{checkException:e=>e<0,exceptionMessage:"Negative number"},notInteger:{checkException:e=>!Number.isInteger(e),exceptionMessage:"number isn't integer"}}},8870:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.functionReg=t.constantReg=t.searchAllowedOperationsRegStr=t.allowedActions=t.Priority=t.calculatorConfig=void 0;const o=r(9219);Object.defineProperty(t,"Priority",{enumerable:!0,get:function(){return o.Priority}});const a=r(3737);Object.defineProperty(t,"calculatorConfig",{enumerable:!0,get:function(){return a.calculatorConfig}});const n=r(6790);t.allowedActions=Object.keys(a.calculatorConfig),t.searchAllowedOperationsRegStr=t.allowedActions.map((e=>1===e.length?`\\${e}`:e)).join("|"),t.constantReg=t.allowedActions.flatMap((e=>a.calculatorConfig[e].type===n.OperationType.Constant?e:[])).join("."),t.functionReg=t.allowedActions.flatMap((e=>a.calculatorConfig[e].type===n.OperationType.MathFunction?e:[])).join("|")},6790:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.OperationType=void 0,(r=t.OperationType||(t.OperationType={}))[r.Operation=0]="Operation",r[r.MathFunction=1]="MathFunction",r[r.Constant=2]="Constant"},3956:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Operation=void 0;const o=r(9915),a=r(6790);t.Operation=class{constructor(e){this.exceptionHandler=[],this.reg=e.reg,this.calculate=e.calculate,this.exceptionHandler=e.exceptionHandler||[],this.type=e.type||a.OperationType.Operation,this.priority=e.priority,this.text=e.text}checkException(e,t){0!==this.exceptionHandler.length&&this.exceptionHandler.forEach((r=>{if(r.checkException(...e))throw o.ErrorFactory.CalculationError(r.exceptionMessage,t)}))}}},9219:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Priority=void 0,t.Priority={Constant:3,Hight:2,Medium:1,Low:0}},727:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateExpression=void 0;const o=r(5099),a=r(8191),n=r(8604);t.validateExpression=function(e){n.calculatorLog.info(`Validate expression: ${e}`);const t=function(e,t){return t.flatMap((t=>t(e)||[]))}(e,[a.pointValidator,a.bracketsOrderValidator,a.bracketsSiblingsValidator,a.zeroDivisionValidator,a.operationsInRow,a.unknownSymbolValidator,a.expressionStartValidator,a.expressionEndValidator,a.functionValidator]);if(t.length>0)throw n.calculatorLog.warn(`Expression invalid: ${JSON.stringify(t)}`),new o.ExpressionValidationError(t);return!0}},4446:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationError=void 0,(r=t.ValidationError||(t.ValidationError={})).ClosedBracketError="unexpected closing bracket",r.OpenBracketError="unexpected open bracket",r.BracketAdjacentCharactersError="incorrect characters near brackets",r.ZeroDivisionError="division by Zero",r.NumberPointError="number with several points",r.OperationsInRowError="several operations are entered in a row",r.PointError="point in incorrect place",r.UnknownSymbolError="unexpected character",r.IncorrectFunctionNameError="incorrect function name",r.LineStartError="incorrect start of expression",r.LineEndError="incorrect end of expression",r.IncorrectFunctionArgumentError="incorrect function argument"},5988:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bracketsOrderValidator=void 0;const o=r(4446);t.bracketsOrderValidator=function(e){let t=0;for(let r=0;r<e.length;r++){const a=e[r];if("("===a)t++;else if(")"===a){if(0===t)return{message:o.ValidationError.ClosedBracketError,errorPlace:[{from:r,to:r}]};t--}}if(t>0){const t=e.indexOf("(");return{message:o.ValidationError.OpenBracketError,errorPlace:[{from:t,to:t}]}}}},5121:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bracketsSiblingsValidator=void 0;const o=r(4446),a=r(133),n=r(8269);t.bracketsSiblingsValidator=function(e){const t=e.match(a.regexPatterns.OPEN_BRACKETS_ADJACENT_SYMBOLS),r=e.match(a.regexPatterns.CLOSED_BRACKETS_ADJACENT_SYMBOLS),i=[];if(t&&i.push(...(0,n.getSubstringsIndexes)(t,e)),r&&i.push(...(0,n.getSubstringsIndexes)(r,e)),i.length>0)return{message:o.ValidationError.BracketAdjacentCharactersError,errorPlace:i}}},9534:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.expressionEndValidator=void 0;const o=r(133),a=r(4446);t.expressionEndValidator=function(e){if(!o.regexPatterns.EXPRESSION_END.test(e))return{message:a.ValidationError.LineEndError,errorPlace:[{from:e.length-1,to:e.length-1}]}}},453:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.expressionStartValidator=void 0;const o=r(133),a=r(4446);t.expressionStartValidator=function(e){if(!o.regexPatterns.EXPRESSION_START.test(e))return{message:a.ValidationError.LineStartError,errorPlace:[{from:0,to:0}]}}},2320:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.functionValidator=void 0;const o=r(8870),a=r(8269),n=r(4446);t.functionValidator=function(e){const t=new RegExp(`(${o.functionReg})(?![\\d(])`,"g"),r=e.match(t);if(r)return{message:n.ValidationError.IncorrectFunctionArgumentError,errorPlace:(0,a.getSubstringsIndexes)(r,e)}}},8405:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.incorrectFunctionNameValidator=void 0;const o=r(8870),a=r(8269),n=r(133),i=r(4446);t.incorrectFunctionNameValidator=function(e){const t=e.match(n.regexPatterns.ALL_WORDS);if(t)for(let r=0;r<t.length;r++){const n=t[r];if(!o.calculatorConfig[n])return{message:i.ValidationError.IncorrectFunctionNameError,errorPlace:(0,a.getSubstringsIndexes)([n],e)}}}},8191:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.functionValidator=t.expressionEndValidator=t.expressionStartValidator=t.incorrectFunctionNameValidator=t.unknownSymbolValidator=t.operationsInRow=t.pointValidator=t.zeroDivisionValidator=t.bracketsSiblingsValidator=t.bracketsOrderValidator=void 0;const o=r(5988);Object.defineProperty(t,"bracketsOrderValidator",{enumerable:!0,get:function(){return o.bracketsOrderValidator}});const a=r(5121);Object.defineProperty(t,"bracketsSiblingsValidator",{enumerable:!0,get:function(){return a.bracketsSiblingsValidator}});const n=r(9534);Object.defineProperty(t,"expressionEndValidator",{enumerable:!0,get:function(){return n.expressionEndValidator}});const i=r(453);Object.defineProperty(t,"expressionStartValidator",{enumerable:!0,get:function(){return i.expressionStartValidator}});const s=r(2320);Object.defineProperty(t,"functionValidator",{enumerable:!0,get:function(){return s.functionValidator}});const c=r(8405);Object.defineProperty(t,"incorrectFunctionNameValidator",{enumerable:!0,get:function(){return c.incorrectFunctionNameValidator}});const l=r(8471);Object.defineProperty(t,"operationsInRow",{enumerable:!0,get:function(){return l.operationsInRow}});const u=r(1581);Object.defineProperty(t,"pointValidator",{enumerable:!0,get:function(){return u.pointValidator}});const d=r(8318);Object.defineProperty(t,"unknownSymbolValidator",{enumerable:!0,get:function(){return d.unknownSymbolValidator}});const p=r(2589);Object.defineProperty(t,"zeroDivisionValidator",{enumerable:!0,get:function(){return p.zeroDivisionValidator}})},8471:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.operationsInRow=void 0;const o=r(133),a=r(4446),n=r(8269);t.operationsInRow=function(e){const t=e.match(o.regexPatterns.OPERATIONS_IN_ROW);if(t)return{message:a.ValidationError.OperationsInRowError,errorPlace:(0,n.getSubstringsIndexes)(t,e)}}},1581:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pointValidator=void 0;const o=r(4446),a=r(133),n=r(8269);t.pointValidator=function(e){for(let t=0;t<e.length;t++)if("."===e[t]&&(isNaN(+e[t-1])||isNaN(+e[t+1])))return{message:o.ValidationError.PointError,errorPlace:[{from:t,to:t}]};const t=e.match(a.regexPatterns.DOUBLE_POINTS_IN_NUMBER);if(t)return{message:o.ValidationError.NumberPointError,errorPlace:(0,n.getSubstringsIndexes)(t,e)}}},8318:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unknownSymbolValidator=void 0;const o=r(4446),a=r(8269),n=r(8405),i=r(8870);t.unknownSymbolValidator=function(e){const t=new RegExp(`[^0-9${i.searchAllowedOperationsRegStr}().]`,"g"),r=e.match(t);return r?{message:o.ValidationError.UnknownSymbolError,errorPlace:(0,a.getSubstringsIndexes)(r,e)}:(0,n.incorrectFunctionNameValidator)(e)}},2589:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.zeroDivisionValidator=void 0;const o=r(133),a=r(4446);t.zeroDivisionValidator=function(e){const t=e.match(o.regexPatterns.ZERO_DIVISION);if(t)return{message:a.ValidationError.ZeroDivisionError,errorPlace:[{from:t.index,to:t.index}]}}},5039:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMostNestedBrackets=void 0;const o=r(133);t.getMostNestedBrackets=function(e){return e.match(o.regexPatterns.MOST_NESTED_BRACKET)||[]}},3005:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasBrackets=void 0,t.hasBrackets=function(e){return e.includes("(")||e.includes(")")}},7905:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unwrapBracketInExpression=void 0,t.unwrapBracketInExpression=function(e){return e.replace(/\(|\)/g,"")}},571:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findSubstringIndexes=void 0,t.findSubstringIndexes=function(e,t,r=0){const o=e.indexOf(t,r);return-1===o?null:{from:o,to:o+t.length-1}}},4613:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatDecimal=void 0,t.formatDecimal=function(e,t=2){const r=10**t;return Math.round(e*r)/r}},7155:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNumbersFromExpression=void 0;const o=r(133);t.getNumbersFromExpression=function(e){const t=e.match(o.regexPatterns.NUMBERS);return t?.map((e=>+e))||[]}},7218:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getOperationsFromExpression=void 0;const o=r(8870);t.getOperationsFromExpression=function(e){const t=new RegExp(`(?<![0-9${o.constantReg}])-`,"g");return e.replace(t,"").match(RegExp(o.searchAllowedOperationsRegStr,"g"))||[]}},8269:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSubstringsIndexes=void 0;const o=r(571);t.getSubstringsIndexes=function(e,t){return e.reduce(((e,r)=>{const a=e[e.length-1]?.to||0,n=(0,o.findSubstringIndexes)(t,r,a);return n?[...e,n]:e}),[])}},133:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.regularWithParam=t.regexPatterns=void 0;const r="(?<!\\d)-?\\d+(\\.\\d+)?(e[+-]?\\d+)?";t.regexPatterns={NUMBERS:new RegExp(r,"g"),MINUS_IN_NUMBER:/(^|-|\()-/g,E_CONST:/(?<![0-9eE.+-])e(?![0-9eE.+-])/,ZERO_DIVISION:/\/0+(?!\.\d)/,OPEN_BRACKETS_ADJACENT_SYMBOLS:/[\d|!]\(|\([\+\*\/\^\!]/g,CLOSED_BRACKETS_ADJACENT_SYMBOLS:/[^\d\)\w\!]\)|\)[\d\w]/g,DOUBLE_POINTS_IN_NUMBER:/\d+(\.\d+){2,}/g,MOST_NESTED_BRACKET:/\(([^()]+)\)/g,OPERATIONS_IN_ROW:/([-+*/^!]{2,})/g,ALL_WORDS:/[a-zA-Z]+/g,EXPRESSION_START:/^(?:(?:-?[a-z])|(?:-?\d)|(?:\())/,EXPRESSION_END:/[)\w!]+$/},t.regularWithParam={getNumberBetweenRegWithSymbol:e=>new RegExp(`${r}[\\${e}]${r}`),getFunctionRegWithParam:e=>new RegExp(`${e}${r}`),getNumbersLeftToSymbolReg:e=>new RegExp(`${r}${e}`),getConstantReg:e=>new RegExp(`(?<![A-Za-z0-9])${e}`)}},5563:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatExpression=void 0;const o=r(9898),a=r(886);t.formatExpression=function(e){return(0,o.formatText)(e,{removeSpaces:a.removeSpaces})}},9898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatText=void 0,t.formatText=function(e,t){return Object.keys(t).reduce(((e,r)=>(0,t[r])(e)),e)}},886:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeSpaces=void 0,t.removeSpaces=function(e){return e.replace(/\s/g,"")}},16:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.factorial=void 0,t.factorial=function e(t){if(0==t||1==t)return 1;if(t<0||!Number.isInteger(t))throw new Error("Incorrect number to calculate");return t*e(t-1)}},8604:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculatorLog=void 0;const o=r(6937);t.calculatorLog=(0,o.createLogger)({loggerLevels:["info","warn"],loggerName:"calculator"})},2815:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.appModule=t.initModules=void 0;const o=r(6860),a=[r(2818).calculatorModule];function n(e=""){const t=(0,o.Router)();return a.forEach((r=>{t.use(`${e}`,r.router)})),t}t.initModules=n,t.appModule=n("/api")},6391:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JsonDB=void 0;const a=o(r(7147));t.JsonDB=class{constructor(e,t){if(this.pathToFile=e,!a.default.existsSync(this.pathToFile)){const e=t||[];a.default.writeFileSync(this.pathToFile,JSON.stringify(e))}}async getLength(){return(await this.getAll()).length}async getAll(){const e=a.default.readFileSync(this.pathToFile,"utf8");return JSON.parse(e)}async count(e){return(await this.getAll()).slice(-e)}async deleteItem(e){const t=this.getAll(),r=(await t).filter((t=>t[e.field]!==e.value));a.default.writeFileSync(this.pathToFile,JSON.stringify(r))}async pop(){const e=(await this.getAll()).slice(1).map((e=>{const t=e.id-1;return{...e,id:t}}));a.default.writeFileSync(this.pathToFile,JSON.stringify(e))}async getItem(e){return(await this.getAll()).find((t=>t[e.field]===e.value))||null}async setItem(e){const t=await this.getAll(),r={...e,id:t.length},o=[...t,r];a.default.writeFileSync(this.pathToFile,JSON.stringify(o))}}},6342:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostgreSQL=void 0;const o=r(4787),a=r(5900);t.PostgreSQL=class{constructor(e){this.pool=new a.Pool({password:"root",port:Number("5432"),user:"admin",host:process.env.POSTGRES_HOST||"localhost"}),this.tableName=e.tableName,this.createTable(e)}async getLength(){const e=await this.query("SELECT COUNT(*) AS total FROM history");return Number(e[0].total)}async getAll(){const e=`SELECT * from ${this.tableName}`;return await this.query(e)}async count(e){const t=`SELECT * FROM (SELECT * FROM ${this.tableName} ORDER BY id DESC LIMIT ${e}) AS subquery ORDER BY id`;return await this.query(t)}async setItem(e){const t=Object.keys(e).join(", "),r=Object.values(e).map((e=>`'${e}'`)).join(", "),o=`INSERT INTO ${this.tableName} (${t}, updated_at) VALUES (${r}, CURRENT_TIMESTAMP)`;await this.query(o)}async deleteItem(e){const t=`DELETE FROM ${this.tableName} WHERE ${e.field} = '${e.value}'`;await this.query(t)}async getItem(e){const t=`SELECT * FROM ${this.tableName} WHERE ${e.field} = '${e.value}'`;return(await this.query(t))[0]}async pop(){const e=`DELETE FROM history WHERE created_at = (SELECT MIN(created_at) FROM ${this.tableName})`;await this.query(e)}async query(e){try{return(await this.pool.query(e)).rows}catch(e){throw console.log(e),o.AppError.getErrorFrom(e)}}async createTable(e){const t=[...e.fields,{name:"id",type:"SERIAL",constraints:["PRIMARY KEY "]},{name:"created_at",type:"TIMESTAMP ",constraints:["DEFAULT","CURRENT_TIMESTAMP"]},{name:"updated_at",type:"TIMESTAMP ",constraints:["DEFAULT","CURRENT_TIMESTAMP"]}].map((e=>this.getFieldQuery(e))).join(", "),r=`CREATE TABLE IF NOT EXISTS "${e.tableName}" (${t});`;await this.query(r)}getFieldQuery(e){const t=e.constraints?e.constraints.join(" "):"";return`"${e.name}" ${e.type} ${t}`}}},4787:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppError=void 0;const o=r(8559);class a{constructor(e){this.status=e?.status||500,this.message=e?.message||"Unexpected error while execution",this.type=e?.type||o.ErrorType.ServerError}static getErrorFrom(e){return e instanceof a?e:new a({status:500,type:o.ErrorType.ServerError})}}t.AppError=a},9915:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorFactory=void 0;const o=r(4787),a=r(8559);t.ErrorFactory={ServerError:()=>new o.AppError({message:"Internal server error",status:500,type:a.ErrorType.ServerError}),BadRequestError:()=>new o.AppError({message:"Bad request",status:400,type:a.ErrorType.BadRequestError}),MissingParameterError:(e,t)=>new o.AppError({message:`Missing required ${t} parameter: ${e}`,status:400,type:a.ErrorType.MissingParameter}),IncorrectParameter:e=>new o.AppError({message:e,status:400,type:a.ErrorType.BadRequestError}),CalculationError:(e,t)=>new o.AppError({message:`Expression contains ${e} in ${t}`,status:422,type:a.ErrorType.RuntimeError})}},5099:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionValidationError=void 0;const o=r(4787),a=r(8559);class n extends o.AppError{constructor(e){super({message:"Expression has incorrect format",type:a.ErrorType.ValidationError,status:400}),this.failedValidations=e}}t.ExpressionValidationError=n},8559:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=void 0,(r=t.ErrorType||(t.ErrorType={})).ValidationError="validationError",r.RuntimeError="runtimeError",r.ServerError="unexpectedServerError",r.MissingParameter="missingParameterError",r.BadRequestError="badRequestError"},9696:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseFormatter=void 0,t.ResponseFormatter=class{constructor(e){this.success=!!e.data,this.status=e.status||e.error?.status||(e.data?200:500),this.data=e.data||null,this.error=e.error||null}json(){return JSON.stringify(this)}}},6937:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createLogger=void 0;const a=o(r(7773));t.createLogger=function({loggerLevels:e,loggerName:t}){return a.default.createLogger({transports:e.map((e=>new a.default.transports.File({filename:`logs/${t}/${e}.log`,level:e}))),format:a.default.format.combine(a.default.format.timestamp(),a.default.format.printf((e=>{const{timestamp:t,level:r,message:o,meta:a}=e;return`[${t}] ${r}: ${o} ${a?JSON.stringify(a):""}`})))})}},935:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.responseHandler=void 0;const o=r(4787),a=r(9696);t.responseHandler=function(e,t,r){const n=r.value;return r.value=async function(e,t,r){try{const o=await n.call(this,e,t,r),i=new a.ResponseFormatter({data:o}).json();t.send(i)}catch(e){const r=o.AppError.getErrorFrom(e),n=new a.ResponseFormatter({error:r}).json();t.status(r.status).send(n)}},r}},3986:e=>{e.exports=require("body-parser")},3582:e=>{e.exports=require("cors")},6860:e=>{e.exports=require("express")},3553:e=>{e.exports=require("express-validator")},3316:e=>{e.exports=require("express-winston")},5900:e=>{e.exports=require("pg")},7773:e=>{e.exports=require("winston")},7147:e=>{e.exports=require("fs")}},t={};!function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(6752)})();